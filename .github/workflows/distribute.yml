name: Distribute to firebase

on:
  push:
    branches: [develop, main, hotfix/fastlane-github-action]

jobs:
  distribute:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - uses: ruby/setup-ruby@v1
        with:
          ruby-version: '2.7.0'
          bundler-cache: true

      # - name: install firebase tool
      #   run: |
      #     yarn global add firebase-tools
      #     echo "::add-path::$(yarn global bin)"

      - name: setup fastlane
        run: bundle install

      # - name: Configure Keystore
      #   run: |
      #     echo "$ANDROID_KEYSTORE_FILE" > keystore.jks.b64
      #     base64 -d -i keystore.jks.b64 > app/keystore.jks
      #     echo "storeFile=keystore.jks" >> keystore.properties
      #     echo "keyAlias=$KEYSTORE_KEY_ALIAS" >> keystore.properties
      #     echo "storePassword=$KEYSTORE_STORE_PASSWORD" >> keystore.properties
      #     echo "keyPassword=$KEYSTORE_KEY_PASSWORD" >> keystore.properties
      #   env:
      #     ANDROID_KEYSTORE_FILE: ${{ secrets.ANDROID_KEYSTORE_FILE }}
      #     KEYSTORE_KEY_ALIAS: ${{ secrets.KEYSTORE_KEY_ALIAS }}
      #     KEYSTORE_KEY_PASSWORD: ${{ secrets.KEYSTORE_KEY_PASSWORD }}
      #     KEYSTORE_STORE_PASSWORD: ${{ secrets.KEYSTORE_STORE_PASSWORD }}

      - name: Create Firebase Service Credentials file
        run: |
          echo "$FIREBASE_CREDENTIALS" > firebase_credentials.json.b64
          base64 -d -i firebase_credentials.json.b64 > firebase_credentials.json
        env:
          FIREBASE_CREDENTIALS: ${{ secrets.FIREBASE_CREDENTIALS }}

      - name: Distribute app with ðŸ”¥ App Distribution ðŸš€
        run: bundle exec fastlane distribute
        env:
          FIREBASE_APP_ID: ${{ secrets.FIREBASE_APP_ID }}
